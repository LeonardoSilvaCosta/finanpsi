"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[475],{2475:(e,o,a)=>{a.d(o,{generateDiagnosisWithFlowise:()=>n});var s=a(357);async function n(e){let o=Date.now(),a=function(){let e=s.env.FLOWISE_BASE_URL||s.env.NEXT_PUBLIC_FLOWISE_URL;return e?{baseUrl:e.replace(/\/$/,""),apiKey:s.env.FLOWISE_API_KEY,timeout:Number(s.env.FLOWISE_TIMEOUT||3e4)}:(console.warn("[Flowise] FLOWISE_BASE_URL n\xe3o configurado"),null)}();if(!a)return{success:!1,error:"Flowise n\xe3o configurado",method:"fallback",responseTime:Date.now()-o};let n=s.env.FLOWISE_CHATFLOW_ID||"default",r="".concat(a.baseUrl,"/api/v1/prediction/").concat(n),i=function(e){let o=e.profession||"profissional",a=e.challenge||"desafios financeiros gerais",s=e.groupAccepted?"O lead demonstrou interesse em participar de grupo de apoio.":"O lead n\xe3o demonstrou interesse em grupo de apoio no momento.";return"Voc\xea \xe9 um consultor financeiro especializado em ajudar psic\xf3logos e profissionais da sa\xfade que s\xe3o aut\xf4nomos e enfrentam desafios financeiros.\n\nContexto do Lead:\n- Nome: ".concat(e.name,"\n- Profiss\xe3o: ").concat(o,"\n- Maior desafio financeiro: ").concat(a,"\n- Interesse em grupo: ").concat(s,"\n\nGere um diagn\xf3stico financeiro personalizado, profissional e acolhedor que:\n1. Identifique o principal desafio mencionado\n2. Forne\xe7a an\xe1lises e a\xe7\xf5es pr\xe1ticas e espec\xedficas\n3. Considere a realidade de profissionais aut\xf4nomos da \xe1rea de sa\xfade\n4. Mantenha um tom emp\xe1tico e encorajador\n5. Inclua passos de a\xe7\xe3o concretos e realiz\xe1veis\n6. Seja relevante para a situa\xe7\xe3o espec\xedfica do lead\n\nFormato desejado:\n- Sauda\xe7\xe3o personalizada\n- Identifica\xe7\xe3o da situa\xe7\xe3o/diagn\xf3stico\n- A\xe7\xf5es recomendadas (bullet points)\n- Insights espec\xedficos para profissionais da sa\xfade (se aplic\xe1vel)\n- Mensagem sobre comunidade (se aplic\xe1vel)\n- Assinatura da Equipe FinanPsi\n\nMantenha o diagn\xf3stico focado, pr\xe1tico e acolhedor. Evite jarg\xf5es t\xe9cnicos complexos demais.")}(e);try{let s=new AbortController,n=setTimeout(()=>s.abort(),a.timeout),c={"Content-Type":"application/json"};a.apiKey&&(c.Authorization="Bearer ".concat(a.apiKey)),console.log("[Flowise] Enviando requisi\xe7\xe3o para: ".concat(r)),console.log("[Flowise] Lead: ".concat(e.email));let l=await fetch(r,{method:"POST",headers:c,body:JSON.stringify({question:i,inputs:{leadName:e.name,leadEmail:e.email,leadProfession:e.profession||"",leadChallenge:e.challenge||"",leadGroupAccepted:e.groupAccepted}}),signal:s.signal});if(clearTimeout(n),!l.ok){let e="Flowise retornou erro ".concat(l.status),a="";try{let o=await l.text();console.error("[Flowise] Erro HTTP ".concat(l.status,":"),o);try{let s=JSON.parse(o);if(s.message){var t;(a=s.message).includes("model")&&a.includes("does not exist")?(e="Modelo LLM n\xe3o configurado no chatflow do Flowise",console.error("[Flowise] ⚠️  ATEN\xc7\xc3O: O chatflow precisa ter um modelo LLM configurado. Acesse o Flowise e configure um n\xf3 LLM no seu chatflow.")):(null===(t=s.error)||void 0===t?void 0:t.message)&&(a=s.error.message)}else s.error&&(a=JSON.stringify(s.error))}catch(e){a=o.substring(0,200)}a&&(e="".concat(e,": ").concat(a))}catch(e){console.error("[Flowise] Erro ao ler resposta de erro:",e)}return{success:!1,error:e,method:"fallback",responseTime:Date.now()-o}}let d=await l.json(),u=Date.now()-o,p="";if(d.text?p=d.text:d.answer?p=d.answer:d.response?p=d.response:"string"==typeof d?p=d:(p=JSON.stringify(d,null,2),console.warn("[Flowise] Formato de resposta n\xe3o reconhecido, usando JSON completo")),!p||0===p.trim().length)throw Error("Resposta vazia do Flowise");return console.log("[Flowise] Diagn\xf3stico gerado com sucesso em ".concat(u,"ms")),{success:!0,diagnosis:p.trim(),method:"flowise",responseTime:u}}catch(r){let e=Date.now()-o,s=r.message||String(r),n="AbortError"===r.name||s.includes("aborted");return n?console.error("[Flowise] Timeout ap\xf3s ".concat(a.timeout,"ms")):console.error("[Flowise] Erro ao gerar diagn\xf3stico:",s),{success:!1,error:n?"Timeout ao conectar com Flowise":s,method:"fallback",responseTime:e}}}}}]);